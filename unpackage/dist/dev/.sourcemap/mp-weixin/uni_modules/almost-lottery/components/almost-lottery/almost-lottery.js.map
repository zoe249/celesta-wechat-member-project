{"version":3,"sources":["webpack:////Users/mac/Documents/悦朋参与项目/2020悦朋项目/微会员/0-开发版本/celesta-wechat-member-project/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue?d681","webpack:////Users/mac/Documents/悦朋参与项目/2020悦朋项目/微会员/0-开发版本/celesta-wechat-member-project/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue?aaad","webpack:////Users/mac/Documents/悦朋参与项目/2020悦朋项目/微会员/0-开发版本/celesta-wechat-member-project/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue?06c8","webpack:////Users/mac/Documents/悦朋参与项目/2020悦朋项目/微会员/0-开发版本/celesta-wechat-member-project/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue?41fd","uni-app:///uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue","webpack:////Users/mac/Documents/悦朋参与项目/2020悦朋项目/微会员/0-开发版本/celesta-wechat-member-project/uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue?4544"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","firstCount","firstText","rewardName","j","lastText","ctx","fillText"],"mappings":"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","file":"uni_modules/almost-lottery/components/almost-lottery/almost-lottery.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./almost-lottery.vue?vue&type=template&id=34b92f46&scoped=true&\"\nvar renderjs\nimport script from \"./almost-lottery.vue?vue&type=script&lang=js&\"\nexport * from \"./almost-lottery.vue?vue&type=script&lang=js&\"\nimport style0 from \"./almost-lottery.vue?vue&type=style&index=0&id=34b92f46&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"34b92f46\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/almost-lottery/components/almost-lottery/almost-lottery.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./almost-lottery.vue?vue&type=template&id=34b92f46&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./almost-lottery.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./almost-lottery.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"almost-lottery\">\r\n    <view class=\"almost-lottery__wrap\" :style=\"{ width: outerWidth + higtCanvasMargin + 'px', height: outerWidth + higtCanvasMargin + 'px'}\" v-if=\"lotteryImg\">\n      <image\n        :src=\"lotteryBg\"\n        mode=\"widthFix\"\n        class=\"almost-lottery__bg\"\n        :style=\"{\n          width: outerWidth + higtCanvasMargin + 'px',\n          height: outerWidth + higtCanvasMargin + 'px'\n        }\"\n      ></image>\r\n      <image\n        class=\"almost-lottery__canvas-img\"\n        mode=\"widthFix\"\n        :src=\"lotteryImg\"\n        :style=\"{\r\n          width: canvasWidth + 'px',\r\n          height: canvasWidth  + 'px',\r\n          transform: `rotate(${canvasAngle + targetAngle}deg)`,\r\n          transitionDuration: `${transitionDuration}s`\r\n        }\"\n      ></image>\n      <image\n        :src=\"actionBg\"\n        mode=\"widthFix\"\n        class=\"almost-lottery__action almost-lottery__action-img\"\n        :style=\"{\n          width: actionWidth + 'px',\n          height: actionHeight + 'px',\r\n          transform: `rotate(${actionAngle + targetActionAngle}deg)`,\r\n          transitionDuration: `${transitionDuration}s`\n        }\"\n        @click=\"handleActionStart\"\n      ></image>\r\n    </view>\n    \n    <!-- 正在绘制转盘时的提示文本 -->\n    <text class=\"almost-lottery__tip\" v-else>{{ almostLotteryTip }}</text>\n    \r\n    <!-- 为了兼容 app 端 ctx.measureText 所需的标签 -->\r\n    <text class=\"almost-lottery__measureText\" :style=\"{ fontSize: higtFontSize + 'px' }\">{{ measureText }}</text>\n    \n    <!-- #ifdef MP-ALIPAY -->\n    <canvas \n      :class=\"className\"\n      :id=\"canvasId\"\n      :width=\"higtCanvasSize\"\n      :height=\"higtCanvasSize\"\n      :style=\"{\n        width: higtCanvasSize + 'px',\n        height: higtCanvasSize + 'px'\n      }\"\n    />\n    <!-- #endif -->\n    <!-- #ifndef MP-ALIPAY -->\n    <canvas\n      :class=\"className\"\n      :canvas-id=\"canvasId\"\n      :width=\"higtCanvasSize\"\n      :height=\"higtCanvasSize\"\n      :style=\"{\n        width: higtCanvasSize + 'px',\n        height: higtCanvasSize + 'px'\n      }\"\n    />\n    <!-- #endif -->\r\n  </view>\r\n</template>\r\n\r\n<script>\n  const systemInfo = uni.getSystemInfoSync()\r\n\timport { getStore, setStore, clearStore, clacTextLen, downloadFile, pathToBase64 } from '@/uni_modules/almost-lottery/utils/almost-utils.js'\r\n  export default {\r\n    name: 'AlmostLottery',\r\n    props: {\r\n      // canvas 宽度\r\n      canvasId: {\r\n        type: String,\n        default: 'almostLotteryCanvas'\r\n      },\r\n      // canvas 宽度\r\n      canvasWidth: {\r\n        type: Number,\r\n        default: 280\r\n      },\r\n      // canvas 高度\r\n      canvasHeight: {\r\n        type: Number,\r\n        default: 280\r\n      },\n      // 转盘外圈的宽度\n      outerWidth: {\n        type: Number,\n        default: 320\n      },\n      // 转盘外圈的高度\n      outerHeight: {\n        type: Number,\n        default: 320\n      },\r\n\t\t\t// 内圈与外圈的间距\r\n\t\t\tcanvasMargin: {\r\n        type: Number,\r\n        default: 5\r\n      },\n      // 抽奖按钮的宽度\n      actionWidth: {\n        type: Number,\n        default: 120\n      },\n      // 抽奖按钮的高度\n      actionHeight: {\n        type: Number,\n        default: 120\n      },\r\n      // 奖品列表\r\n      prizeList: {\r\n        type: Array,\r\n        required: true,\r\n        validator: (value) => {\r\n          return value.length > 1\r\n        }\r\n      },\r\n      // 中奖奖品在列表中的下标\r\n      prizeIndex: {\r\n        type: Number,\r\n        required: true\r\n      },\r\n      // 奖品区块对应背景颜色\r\n      colors: {\r\n        type: Array,\r\n        default: () => [\r\n          '#FFFFFF',\r\n          '#FFE9AA'\r\n        ]\r\n      },\n      // 转盘外环背景图\n      lotteryBg: {\r\n        type: String,\r\n        default: '/uni_modules/almost-lottery/static/almost-lottery/almost-lottery__bg2x.png'\n      },\n      // 抽奖按钮背景图\n      actionBg: {\r\n        type: String,\r\n        default: '/uni_modules/almost-lottery/static/almost-lottery/almost-lottery__action2x.png'\n      },\n      // 是否绘制奖品名称\n      prizeNameDrawed: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\n      },\n      // 是否开启奖品区块描边\n      stroked: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n      // 描边颜色\r\n      strokeColor: {\r\n        type: String,\r\n        default: '#FFE9AA'\r\n      },\n      // 旋转的类型\n      rotateType: {\n        type: String,\n        default: 'roulette'\n      },\r\n      // 旋转动画时间 单位s\r\n      duration: {\r\n        type: Number,\r\n        default: 8\r\n      },\r\n      // 旋转的圈数\r\n      ringCount: {\r\n        type: Number,\r\n        default: 8\r\n      },\r\n      // 指针位置\r\n      pointerPosition: {\r\n        type: String,\r\n        default: 'edge',\r\n        validator: (value) => {\r\n          return value === 'edge' || value === 'middle'\r\n        }\r\n      },\n      // 文字方向\n      strDirection: {\r\n        type: String,\r\n        default: 'horizontal'\n      },\r\n      // 字体颜色\r\n      strFontColor: {\r\n        type: String,\r\n        default: '#C30B29'\r\n      },\r\n      // 文字的大小\r\n      strFontSize: {\r\n        type: Number,\r\n        default: 12\r\n      },\r\n      // 奖品文字距离边缘的距离\r\n      strMarginOutside: {\r\n        type: Number,\r\n        default: 0\r\n      },\r\n      // 奖品图片距离奖品文字的距离\r\n      imgMarginStr: {\r\n        type: Number,\r\n        default: 25\r\n      },\r\n      // 奖品文字多行情况下的行高\r\n      strLineHeight: {\r\n        type: Number,\r\n        default: 1.2\r\n      },\r\n      // 奖品名称所对应的 key 值\r\n      strKey: {\r\n        type: String,\r\n        default: 'name'\r\n      },\r\n      // 奖品文字总长度限制\r\n      strMaxLen: {\r\n        type: Number,\r\n        default: 12\r\n      },\r\n      // 奖品文字多行情况下第一行文字长度\r\n      strLineLen: {\r\n        type: Number,\r\n        default: 6\r\n      },\r\n      // 奖品图片的宽\r\n      imgWidth: {\r\n        type: Number,\r\n        default: 30\r\n      },\r\n      // 奖品图片的高\r\n      imgHeight: {\r\n        type: Number,\r\n        default: 30\r\n      },\r\n\t\t\t// 转盘绘制成功的提示\r\n\t\t\tsuccessMsg: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '奖品准备就绪，快来参与抽奖吧'\r\n\t\t\t},\r\n\t\t\t// 转盘绘制失败的提示\r\n\t\t\tfailMsg: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '奖品仍在准备中，请稍后再来...'\r\n\t\t\t},\r\n\t\t\t// 是否开启画板的缓存\r\n\t\t\tcanvasCached: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n    },\r\n    data() {\r\n      return {\r\n        // 画板className\r\n        className: 'almost-lottery__canvas',\r\n        // 画板导出的图片\r\n        lotteryImg: '',\r\n        // 旋转到奖品目标需要的角度\r\n        targetAngle: 0,\n        targetActionAngle: 0,\r\n        // 旋转动画时间 单位 s\r\n        transitionDuration: 0,\r\n        // 是否正在旋转\r\n        isRotate: false,\r\n        // 当前停留在那个奖品的序号\r\n        stayIndex: 0,\r\n        // 当前中奖奖品的序号\r\n        targetIndex: 0,\r\n\t\t\t\t// 是否存在可用的缓存转盘图\r\n\t\t\t\tisCacheImg: false,\r\n\t\t\t\toldLotteryImg: '',\n        // 转盘绘制时的提示\n        almostLotteryTip: '奖品准备中...',\r\n        // 解决 app 不支持 measureText 的问题\r\n\t\t\t\t// app 已在 2.9.3 的版本中提供了对 measureText 的支持，将在后续版本逐渐稳定后移除相关兼容代码\r\n        measureText: ''\r\n      }\r\n    },\r\n    computed: {\n      // 高清尺寸\n      higtCanvasSize() {\n        return this.canvasWidth * systemInfo.pixelRatio\n      },\n      // 高清字体\n      higtFontSize() {\n        return this.strFontSize * systemInfo.pixelRatio\n      },\n      // 高清行高\n      higtHeightMultiple() {\n        return this.strFontSize * this.strLineHeight * systemInfo.pixelRatio\n      },\n      // 高清内外圈间距\n      higtCanvasMargin() {\n        return this.canvasMargin * systemInfo.pixelRatio\n      },\r\n      // 根据奖品列表计算 canvas 旋转角度\r\n      canvasAngle() {\r\n        let result = 0\r\n        \n        let prizeCount = this.prizeList.length\n        let prizeClip = 360 / prizeCount\n        let diffNum = 90 / prizeClip\n        if (this.pointerPosition === 'edge' || this.rotateType === 'pointer') {\n          result = -(prizeClip * diffNum)\n        } else {\n          result = -(prizeClip * diffNum + prizeClip / 2)\n        }\r\n        return result\r\n      },\n      actionAngle() {\n        return 0\n      },\r\n      // 外圆的半径\r\n      outsideRadius() {\r\n        return this.higtCanvasSize / 2\r\n      },\r\n      // 内圆的半径\r\n      insideRadius() {\r\n        return 20 * systemInfo.pixelRatio\r\n      },\r\n      // 文字距离边缘的距离\r\n      textRadius() {\r\n        return this.strMarginOutside * systemInfo.pixelRatio || (this.higtFontSize / 2)\r\n      },\r\n      // 根据画板的宽度计算奖品文字与中心点的距离\r\n      textDistance() {\r\n        const textZeroY = Math.round(this.outsideRadius - (this.insideRadius / 2))\r\n        return textZeroY - this.textRadius\r\n      }\r\n    },\r\n    watch: {\r\n      // 监听获奖序号的变动\r\n      prizeIndex(newVal, oldVal) {\r\n        if (newVal > -1) {\r\n          this.targetIndex = newVal\r\n          this.onRotateStart()\r\n        } else {\r\n          console.info('旋转结束，prizeIndex 已重置')\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      // 开始旋转\r\n      onRotateStart() {\r\n        if (this.isRotate) return\r\n        this.isRotate = true\r\n        // 奖品总数\r\n        let prizeCount = this.prizeList.length\r\n        let baseAngle = 360 / prizeCount\r\n        let angles = 0\n        \n        if (this.rotateType === 'pointer') {\n          if (this.targetActionAngle === 0) {\n            // 第一次旋转\n            angles = (this.targetIndex - this.stayIndex) * baseAngle + baseAngle / 2 - this.actionAngle\n          } else {\n            // 后续旋转\n            // 后续继续旋转 就只需要计算停留的位置与目标位置的角度\n            angles = (this.targetIndex - this.stayIndex) * baseAngle\n          }\n          \n          // 更新目前序号\n          this.stayIndex = this.targetIndex\n          // 转 8 圈，圈数越多，转的越快\n          this.targetActionAngle += angles + 360 * this.ringCount\n          console.log('targetActionAngle', this.targetActionAngle)\n        } else {\n          if (this.targetAngle === 0) {\n            // 第一次旋转\n            // 因为第一个奖品是从0°开始的，即水平向右方向\n            // 第一次旋转角度 = 270度 - (停留的序号-目标序号) * 每个奖品区间角度 - 每个奖品区间角度的一半 - canvas自身旋转的度数\n            angles = (270 - (this.targetIndex - this.stayIndex) * baseAngle - baseAngle / 2) - this.canvasAngle\n          } else {\n            // 后续旋转\n            // 后续继续旋转 就只需要计算停留的位置与目标位置的角度\n            angles = -(this.targetIndex - this.stayIndex) * baseAngle\n          }\n          \r\n          // 更新目前序号\r\n          this.stayIndex = this.targetIndex\r\n          // 转 8 圈，圈数越多，转的越快\r\n          this.targetAngle += angles + 360 * this.ringCount\n        }\r\n\r\n        // 计算转盘结束的时间，预加一些延迟确保转盘停止后触发结束事件\r\n        let endTime = this.transitionDuration * 1000 + 100\r\n        let endTimer = setTimeout(() => {\r\n          clearTimeout(endTimer)\r\n          endTimer = null\r\n\r\n          this.isRotate = false\r\n          this.$emit('draw-end')\r\n        }, endTime)\r\n\r\n        let resetPrizeTimer = setTimeout(() => {\r\n          clearTimeout(resetPrizeTimer)\r\n          resetPrizeTimer = null\r\n\r\n          // 每次抽奖结束后都要重置父级组件的 prizeIndex\r\n          this.$emit('reset-index')\r\n        }, endTime + 50)\r\n      },\r\n      // 点击 开始抽奖 按钮\r\n      handleActionStart() {\n        if (!this.lotteryImg) return\r\n        if (this.isRotate) return\r\n        this.$emit('draw-start')\r\n      },\r\n      // 渲染转盘\r\n      async onCreateCanvas() {\r\n        // 获取 canvas 画布\r\n        const canvasId = this.canvasId\r\n        const ctx = uni.createCanvasContext(canvasId, this)\r\n\r\n        // canvas 的宽高\r\n        let canvasW = this.higtCanvasSize\r\n        let canvasH = this.higtCanvasSize\r\n\r\n        // 根据奖品个数计算 角度\r\n        let prizeCount = this.prizeList.length\r\n        let baseAngle = Math.PI * 2 / prizeCount\r\n\r\n        // 设置字体\r\n        ctx.setFontSize(this.higtFontSize)\r\n\r\n        // 注意，开始画的位置是从0°角的位置开始画的。也就是水平向右的方向。\r\n        // 画具体内容\r\n        for (let i = 0; i < prizeCount; i++) {\r\n\t\t\t\t\tlet prizeItem = this.prizeList[i]\r\n          // 当前角度\r\n          let angle = i * baseAngle\r\n\r\n          // 保存当前画布的状态\r\n          ctx.save()\r\n          \r\n          // x => 圆弧对应的圆心横坐标 x\r\n          // y => 圆弧对应的圆心横坐标 y\r\n          // radius => 圆弧的半径大小\r\n          // startAngle => 圆弧开始的角度，单位是弧度\r\n          // endAngle => 圆弧结束的角度，单位是弧度\r\n          // anticlockwise(可选) => 绘制方向，true 为逆时针，false 为顺时针\n          \n          ctx.beginPath()\n          // 外圆\n          ctx.arc(canvasW * 0.5, canvasH * 0.5, this.outsideRadius, angle, angle + baseAngle, false)\n          // 内圆\r\n          ctx.arc(canvasW * 0.5, canvasH * 0.5, this.insideRadius, angle + baseAngle, angle, true)\n          \r\n          // 每个奖品区块背景填充颜色\r\n          if (this.colors.length === 2) {\r\n            ctx.setFillStyle(this.colors[i % 2])\r\n          } else {\r\n            ctx.setFillStyle(this.colors[i])\r\n          }\r\n          // 填充颜色\r\n          ctx.fill()\n          \n          // 开启描边\n          if (this.stroked) {\n            // 设置描边颜色\n            ctx.setStrokeStyle(`${this.strokeColor}`)\n            // 描边\n            ctx.stroke()\n          }\r\n\r\n          // 开始绘制奖品内容\r\n          // 重新映射画布上的 (0,0) 位置\r\n          let translateX = canvasW * 0.5 + Math.cos(angle + baseAngle / 2) * this.textDistance\r\n          let translateY = canvasH * 0.5 + Math.sin(angle + baseAngle / 2) * this.textDistance\r\n          ctx.translate(translateX, translateY)\r\n\r\n          // 绘制奖品名称\r\n          ctx.setFillStyle(this.strFontColor)\r\n          let rewardName = this.strLimit(prizeItem[this.strKey])\n          \r\n          // rotate方法旋转当前的绘图，因为文字是和当前扇形中心线垂直的\r\n          ctx.rotate(angle + (baseAngle / 2) + (Math.PI / 2))\r\n\r\n          // 设置文本位置并处理换行\n          if (this.strDirection === 'horizontal') {\n            // 是否需要换行\n            if (rewardName && this.prizeNameDrawed) {\n              let realLen = clacTextLen(rewardName).realLen\n              let isLineBreak = realLen > this.strLineLen\n              if (isLineBreak) {\n                // 获得多行文本数组\n                let firstText = ''\n                let lastText = ''\n                let firstCount = 0\n                for (let j = 0; j < rewardName.length; j++) {\n                  firstCount += clacTextLen(rewardName[j]).byteLen\n                  if (firstCount <= (this.strLineLen * 2)) {\n                    firstText += rewardName[j]\n                  } else {\n                    lastText += rewardName[j]\n                  }\n                }\n                rewardName = firstText + ',' + lastText\n                let rewardNames = rewardName.split(',')\n                // 循环文本数组，计算每一行的文本宽度\n                for (let j = 0; j < rewardNames.length; j++) {\n                  if (ctx.measureText && ctx.measureText(rewardNames[j]).width > 0) {\n                    // 文本的宽度信息\n                    let tempStrSize = ctx.measureText(rewardNames[j])\n                    let tempStrWidth = -(tempStrSize.width / 2).toFixed(2)\n                    ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\n                  } else {\n                    this.measureText = rewardNames[j]\n                    \n                    // 等待页面重新渲染\n                    await this.$nextTick()\n                    \n                    let textWidth = await this.getTextWidth()\n                    let tempStrWidth = -(textWidth / 2).toFixed(2)\n                    ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\n                    // console.log(rewardNames[j], textWidth, i)\n                  }\n                }\n              } else {\n                if (ctx.measureText && ctx.measureText(rewardName).width > 0) {\n                  // 文本的宽度信息\n                  let tempStrSize = ctx.measureText(rewardName)\n                  let tempStrWidth = -(tempStrSize.width / 2).toFixed(2)\n                  ctx.fillText(rewardName, tempStrWidth, 0)\n                } else {\n                  this.measureText = rewardName\n                  \n                  // 等待页面重新渲染\n                  await this.$nextTick()\n                  \n                  let textWidth = await this.getTextWidth()\n                  let tempStrWidth = -(textWidth / 2).toFixed(2)\n                  ctx.fillText(rewardName, tempStrWidth, 0)\n                }\n              }\n            }\n          } else {\n            let rewardNames = rewardName.split('')\n            for (let j = 0; j < rewardNames.length; j++) {\n              if (ctx.measureText && ctx.measureText(rewardNames[j]).width > 0) {\n                // 文本的宽度信息\n                let tempStrSize = ctx.measureText(rewardNames[j])\n                let tempStrWidth = -(tempStrSize.width / 2).toFixed(2)\n                ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\n              } else {\n                this.measureText = rewardNames[j]\n                \n                // 等待页面重新渲染\n                await this.$nextTick()\n                \n                let textWidth = await this.getTextWidth()\n                let tempStrWidth = -(textWidth / 2).toFixed(2)\n                ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\n                // console.log(rewardNames[j], textWidth, i)\n              }\n            }\n          }\r\n          \r\n\r\n          // 绘制奖品图片，文字竖向展示时，不支持图片展示\r\n          if (prizeItem.prizeImage && this.strDirection !== 'vertical') {\r\n\t\t\t\t\t\t// App-Android平台 系统 webview 更新到 Chrome84+ 后 canvas 组件绘制本地图像 uni.canvasToTempFilePath 会报错\r\n\t\t\t\t\t\t// 统一将图片处理成 base64\r\n\t\t\t\t\t\t// https://ask.dcloud.net.cn/question/103303\r\n\t\t\t\t\t\tlet reg = /^(https|http)/g\r\n\t\t\t\t\t\t// 处理远程图片\r\n\t\t\t\t\t\tif (reg.test(prizeItem.prizeImage)) {\n              let platformTips = ''\n              // #ifdef APP-PLUS\r\n\t\t\t\t\t\t\tplatformTips = ''\n              // #endif\n              // #ifdef MP\r\n\t\t\t\t\t\t\tplatformTips = '需要处理好下载域名的白名单问题，'\n              // #endif\n              // #ifdef H5\r\n\t\t\t\t\t\t\tplatformTips = '需要处理好跨域问题，'\n              // #endif\r\n\t\t\t\t\t\t\tconsole.warn(`###当前数据列表中的奖品图片为网络图片，${platformTips}开始尝试下载图片...###`)\r\n\t\t\t\t\t\t\tlet res = await downloadFile(prizeItem.prizeImage)\r\n\t\t\t\t\t\t\tconsole.log('处理远程图片', res)\r\n\t\t\t\t\t\t\tif (res.ok) {\r\n\t\t\t\t\t\t\t\tlet tempFilePath = res.tempFilePath\r\n\t\t\t\t\t\t\t\t// #ifndef MP\r\n\t\t\t\t\t\t\t\tprizeItem.prizeImage = await pathToBase64(tempFilePath)\r\n\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t// #ifdef MP\r\n\t\t\t\t\t\t\t\tprizeItem.prizeImage = tempFilePath\r\n\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t} else {\n                this.handlePrizeImgSuc({\n                  ok: false,\n                  data: res.data,\n                  msg: res.msg\n                })\n              }\r\n\t\t\t\t\t\t} else {\n              console.log('处理非远程图片', prizeItem.prizeImage)\r\n\t\t\t\t\t\t\t// #ifndef MP\n              if (prizeItem.prizeImage.indexOf(';base64,') === -1) {\r\n                prizeItem.prizeImage = await pathToBase64(prizeItem.prizeImage)\n              }\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t}\n            \n            let prizeImageX = -(this.imgWidth * systemInfo.pixelRatio / 2)\n            let prizeImageY = this.imgMarginStr * systemInfo.pixelRatio\n            let prizeImageW = this.imgWidth * systemInfo.pixelRatio\n            let prizeImageH = this.imgHeight * systemInfo.pixelRatio\r\n            ctx.drawImage(prizeItem.prizeImage, prizeImageX, prizeImageY, prizeImageW, prizeImageH)\r\n          }\r\n\r\n          ctx.restore()\r\n        }\r\n\r\n        // 保存绘图并导出图片\r\n        ctx.draw(true, () => {\r\n          let drawTimer = setTimeout(() => {\r\n            clearTimeout(drawTimer)\r\n            drawTimer = null\r\n\r\n            // #ifdef MP-ALIPAY\r\n            ctx.toTempFilePath({\r\n              destWidth: this.canvasWidth * systemInfo.pixelRatio,\r\n              destHeight: this.canvasHeight * systemInfo.pixelRatio,\r\n              success: (res) => {\r\n                // console.log(res.apFilePath)\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\t\t\tdata: res.apFilePath,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t\t\t})\r\n              },\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: false,\r\n\t\t\t\t\t\t\t\t\tdata: err,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片失败'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n            })\r\n            // #endif\n            \r\n            // #ifndef MP-ALIPAY\r\n            uni.canvasToTempFilePath({\r\n              canvasId: this.canvasId,\r\n              success: (res) => {\r\n                // 在 H5 平台下，tempFilePath 为 base64\r\n                // console.log(res.tempFilePath)\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\t\t\tdata: res.tempFilePath,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t\t\t})\r\n              },\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: false,\r\n\t\t\t\t\t\t\t\t\tdata: err,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片失败'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n            }, this)\r\n            // #endif\r\n          }, 500)\r\n        })\r\n      },\r\n      // 处理导出的图片\r\n      handlePrizeImg(res) {\r\n\t\t\t\tif (res.ok) {\r\n\t\t\t\t\tlet data = res.data\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!this.canvasCached) {\r\n\t\t\t\t\t\tthis.lotteryImg = data\r\n\t\t\t\t\t\tthis.handlePrizeImgSuc(res)\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\tif (this.isCacheImg) {\r\n\t\t\t\t\t\tuni.getSavedFileList({\r\n\t\t\t\t\t\t\tsuccess: (sucRes) => {\r\n\t\t\t\t\t\t\t\tlet fileList = sucRes.fileList\r\n\t\t\t\t\t\t\t\t// console.log('getSavedFileList Cached', fileList)\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlet cached = false\n                \n                if (fileList.length) {\n                  for (let i = 0; i < fileList.length; i++) {\n                  \tlet item = fileList[i]\n                  \tif (item.filePath === data) {\n                  \t\tcached = true\n                  \t\tthis.lotteryImg = data\n                  \t\t\n                  \t\tconsole.info('经查，本地缓存中存在的转盘图可用，本次将不再绘制转盘')\n                  \t\tthis.handlePrizeImgSuc(res)\n                  \t\tbreak\n                  \t}\n                  }\n                }\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (!cached) {\r\n\t\t\t\t\t\t\t\t\tconsole.info('经查，本地缓存中存在的转盘图不可用，需要重新初始化转盘绘制')\r\n\t\t\t\t\t\t\t\t\tthis.initCanvasDraw()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tthis.initCanvasDraw()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.saveFile({\r\n\t\t\t\t\t\t\ttempFilePath: data,\r\n\t\t\t\t\t\t\tsuccess: (sucRes) => {\r\n\t\t\t\t\t\t\t\tlet filePath = sucRes.savedFilePath\r\n\t\t\t\t\t\t\t\t// console.log('saveFile', filePath)\r\n\t\t\t\t\t\t\t\tsetStore(`${this.canvasId}LotteryImg`, filePath)\r\n\t\t\t\t\t\t\t\tthis.lotteryImg = filePath\r\n\t\t\t\t\t\t\t\tthis.handlePrizeImgSuc({\r\n\t\t\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\t\t\tdata: filePath,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tthis.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: false,\r\n\t\t\t\t\t\t\t\t\tdata: err,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片失败'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tsetStore(`${this.canvasId}LotteryImg`, data)\r\n\t\t\t\t\tthis.lotteryImg = data\r\n\t\t\t\t\tthis.handlePrizeImgSuc(res)\r\n          \r\n          // console info\r\n          let consoleText = this.isCacheImg ? '缓存' : '导出'\r\n          console.info(`当前为 H5 端，使用${consoleText}中的 base64 图`)\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('处理导出的图片失败', res)\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tconsole.error('###当前为 H5 端，下载网络图片需要后端配置允许跨域###')\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifdef MP\r\n\t\t\t\t\tconsole.error('###当前为小程序端，下载网络图片需要配置域名白名单###')\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n      },\r\n\t\t\t// 处理图片完成\r\n\t\t\thandlePrizeImgSuc (res) {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t\tthis.$emit('finish', {\r\n\t\t\t\t\tok: res.ok,\r\n\t\t\t\t\tdata: res.data,\r\n\t\t\t\t\tmsg: res.ok ? this.successMsg : this.failMsg\r\n\t\t\t\t})\n        this.almostLotteryTip = res.ok ? this.successMsg : this.failMsg\r\n\t\t\t},\r\n      // 兼容 app 端不支持 ctx.measureText\r\n      // 已知问题：初始绘制时，低端安卓机 平均耗时 2s\n      // hbx 2.8.12+ 已在 app 端支持\r\n      getTextWidth() {\n        console.warn('正在采用兼容方式获取文本的 size 信息，虽然没有任何问题，如果可以，请将此 systemInfo 及 hbx 版本号 反馈给作者', systemInfo)\n        let query = uni.createSelectorQuery().in(this)\n        let nodesRef = query.select('.almost-lottery__measureText')\r\n        return new Promise((resolve, reject) => {\r\n          nodesRef.fields({\r\n            size: true,\r\n          }, (res) => {\r\n            resolve(res.width)\r\n          }).exec()\r\n        })\r\n      },\r\n      // 处理文字溢出\r\n      strLimit(value) {\r\n        let maxLength = this.strMaxLen\r\n        if (!value || !maxLength) return value\r\n        return clacTextLen(value).realLen > maxLength ? value.slice(0, maxLength - 1) + '..' : value\r\n      },\r\n\t\t\t// 检查本地缓存中是否存在转盘图\r\n\t\t\tcheckCacheImg () {\r\n\t\t\t\tconsole.log('检查本地缓存中是否存在转盘图')\r\n\t\t\t\t// 检查是否已有缓存的转盘图\r\n\t\t\t\t// 检查是否与本次奖品数据相同\r\n\t\t\t\tthis.oldLotteryImg = getStore(`${this.canvasId}LotteryImg`)\r\n\t\t\t\tlet oldPrizeList = getStore(`${this.canvasId}PrizeList`)\r\n\t\t\t\tlet newPrizeList = JSON.stringify(this.prizeList)\r\n\t\t\t\tif (this.oldLotteryImg) {\r\n\t\t\t\t\tif (oldPrizeList === newPrizeList) {\r\n\t\t\t\t\t\tconsole.log(`经查，本地缓存中存在转盘图 => ${this.oldLotteryImg}`)\r\n\t\t\t\t\t\tthis.isCacheImg = true\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('需要继续判断这张缓存图是否可用')\r\n\t\t\t\t\t\tthis.handlePrizeImg({\r\n\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\tdata: this.oldLotteryImg,\r\n\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('经查，本地缓存中不存在转盘图')\r\n\t\t\t\tthis.initCanvasDraw()\r\n\t\t\t},\r\n      // 初始化绘制\r\n      initCanvasDraw () {\r\n\t\t\t\tconsole.log('开始初始化转盘绘制')\r\n\t\t\t\tthis.isCacheImg = false\r\n\t\t\t\tthis.lotteryImg = ''\r\n\t\t\t\tclearStore(`${this.canvasId}LotteryImg`)\r\n        setStore(`${this.canvasId}PrizeList`, this.prizeList)\r\n        this.onCreateCanvas()\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n        let stoTimer = setTimeout(() => {\r\n          clearTimeout(stoTimer)\r\n          stoTimer = null\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.canvasCached) {\r\n\t\t\t\t\t\tthis.checkCacheImg()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.onCreateCanvas()\r\n\t\t\t\t\t}\r\n          this.transitionDuration = this.duration\r\n        }, 50)\r\n      })\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .almost-lottery {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    margin: 0 auto;\r\n  }\n  \r\n\t.almost-lottery__wrap {\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n\t}\r\n\r\n  .almost-lottery__action,\n  .almost-lottery__bg,\n  .almost-lottery__canvas {\r\n    position: absolute;\r\n  }\r\n\r\n  .almost-lottery__canvas {\r\n    left: -9999px;\r\n    opacity: 0;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .almost-lottery__canvas-img,\n  .almost-lottery__action-bg {\r\n\t\tdisplay: block;\r\n    transition: transform cubic-bezier(.34, .12, .05, .95);\r\n  }\r\n\n  .almost-lottery__tip {\n    color: #FFFFFF;\n    font-size: 24rpx;\n    text-align: center;\n  }\n  \r\n  .almost-lottery__measureText {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    white-space: nowrap;\r\n    font-size: 12px;\r\n    opacity: 0;\r\n  }\r\n</style>\r\n","import mod from \"-!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./almost-lottery.vue?vue&type=style&index=0&id=34b92f46&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./almost-lottery.vue?vue&type=style&index=0&id=34b92f46&lang=scss&scoped=true&\""],"sourceRoot":""}